<%= form_with model: document,
              local: true,
              html: { class: "doc-form" } do |f| %>

  <% if document.errors.any? %>
    <div class="form-errors">
      <strong><%= pluralize(document.errors.count, "Fehler") %>:</strong>
      <ul>
        <% document.errors.full_messages.each do |m| %><li><%= m %></li><% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-grid">
    <div class="form-group">
      <label for="doc_title">Titel</label>
      <%= f.text_field :title, id: "doc_title", class: "input" %>
    </div>

    <div class="form-group">
      <label for="doc_template">Template-ID</label>
      <%= f.number_field :template_id, id: "doc_template", class: "input" %>
      <small class="help">Von welchem Template stammt dieses Dokument?</small>
    </div>

    <div class="form-group" style="grid-column:1/-1">
      <%= f.label :body, "Body (optional / frei)" %>
      <%= f.text_area :body, id: "doc_body", rows: 8, class: "input" %>
      <small class="help">
        Wenn das Dokument aus einem Template erzeugt wurde, steht der gerenderte Inhalt unten als Vorschau.
      </small>
    </div>

    <% if document.respond_to?(:compiled_body) && document.compiled_body.present? %>
      <div class="form-group" style="grid-column:1/-1">
        <label for="compiled_preview">Gerenderter Inhalt (readonly)</label>
        <textarea id="compiled_preview"
                  class="input"
                  rows="14"
                  readonly><%= document.compiled_body %></textarea>

        <div class="form-actions" style="justify-content:flex-start;margin-top:.5rem">
          <button type="button"
                  class="btn ghost"
                  data-copy-to="#doc_body"
                  data-source="#compiled_preview">
            In Body Ã¼bernehmen
          </button>
        </div>
      </div>
    <% end %>
  </div>

  <div class="form-actions">
    <%= f.submit (document.persisted? ? "Dokument aktualisieren" : "Dokument anlegen"), class: "btn" %>
    <%= link_to "Abbrechen", (document.persisted? ? document_path(document) : documents_path), class: "btn ghost" %>
  </div>
<% end %>
