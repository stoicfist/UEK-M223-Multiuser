<div class="users-page">
  <h1>Benutzerverwaltung</h1>

  <div class="users-card">
    <div class="toolbar">
      <div class="toolbar-left">
        <div class="muted">Benutzerübersicht</div>
      </div>
    </div>

    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr>
            <th style="width:72px">ID</th>
            <th>Benutzername</th>
            <th>E-Mail</th>
            <th style="width:140px">Rolle</th>
            <th class="hide-sm" style="width:180px">Erstellt</th>
            <th>Aktionen</th>
          </tr>
        </thead>
        <tbody>
          <% @users.each do |u| %>
            <tr id="<%= dom_id(u) %>">
              <td class="muted"><%= u.id %></td>
              <td><%= u.username.presence || "—" %></td>
              <td><%= mail_to u.email %></td>
              <td><span class="chip <%= u.role.presence || "user" %>"><%= u.role.presence || "user" %></span></td>
              <td class="hide-sm muted"><%= l(u.created_at, format: :short) rescue u.created_at.to_s %></td>
              <td class="actions">
                <div class="actions-row" style="display:flex; flex-direction:column; align-items:flex-start; gap:.4rem;">
                  <% if policy(u).update? %>
                    <%= link_to "Bearbeiten", edit_admin_user_path(u), class: "btn ghost" %>
                  <% end %>

                  <% if policy(u).update_role? && !u.admin? %>
                    <%= button_to "Rolle zu Admin",
                          update_role_admin_user_path(u, user: { role: "admin" }),
                          method: :patch,
                          class: "btn",
                          form: { class: "inline-form",
                                  data: { turbo_confirm: "Diesen Benutzer wirklich zum Admin machen?" } } %>
                  <% end %>

                  <% if policy(u).destroy? %>
                    <%= link_to "Löschen", admin_user_path(u),
                          class: "btn danger",
                          data: { turbo_method: :delete, turbo_confirm: "Sicher?" } %>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
